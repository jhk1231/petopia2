<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<div id="layoutSidenav_content">
	<main>
		<div class="container-fluid px-4">

			<div class="row mt-3 mb-5">
				<div id="search">
					<select name="" id="keyfield">
						<option value="email">ID</option>
						<option value="name">등급</option>
					</select> <input type="text" id="keyword">
				</div>
				<button type="button" id="searchBtn">검색</button>
				<table>
					<thead>
						<tr>
							<th>NO</th>
							<th>ID</th>
							<th>등급</th>
							<th>가입 날짜</th>
							<th>방문 횟수</th>
							<th>비고</th>
						</tr>
					</thead>

					<tbody th:each="member : ${lst}" id="memberBody">
						<tr th:object="${member}">
							<td th:text="*{no}"></td>
							<td><a th:href="@{/members/{no}(no=${member.no})}"
								th:text="*{email}"></a></td>
							<td th:text="*{grade}"></td>
							<td th:text="*{regDate}"></td>
							<td th:text="*{visits}"></td>
							<td th:text="*{ban}"></td>
						</tr>
					</tbody>
				</table>
				<div id="pageContent">
					<ul id="paging" th:object="${paging}">
						<li th:if="*{prev == true}"><a
							th:href="@{/members(currentPageNo=1)}">&laquo;</a></li>
						<li th:if="*{prev == true}"><a
							th:href="@{/members(currentPageNo=*{startPage-1})}">&lsquo;</a></li>
						<li th:each="i : *{#numbers.sequence(startPage, endPage)}"><a
							th:href="@{/members(currentPageNo=${i})}" th:text="${i}"></a></li>
						<li th:if="*{next == true}"><a
							th:href="@{/members(currentPageNo=*{endPage+1})}">&rsquo;</a></li>
						<li th:if="*{next == true}"><a
							th:href="@{/members(currentPageNo=*{endNumber})}">&raquo;</a></li>
					</ul>
				</div>
			</div>
		</div>
	</main>
</div>

<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
<script>
$(document).ready(function() {
	$('#searchBtn').on('click', function sendData() {
		const keyfield = $("#keyfield option:selected").val();
		const keyword = $("#keyword").val();
		const url = "/members";
		if (keyword.trim() == "") {
			alert("검색어를 입력해주세요.");
			return;
		}

		$.ajax({
			url : url,
			method : "POST",
			dataType : "json",
			data : {
				keyfield : keyfield,
				keyword : keyword
			},

			success : function(data) {
				console.log(data.paging);
				var page = data.paging;
				$("#memberBody tr").remove();
				$("#paging").remove();
				var htmlStr = [];
				for(let list of data.lst) {
					htmlStr.push('<tr id=">'+ list.no +'">');
					htmlStr.push('<td>'+ list.no +'</td>');
					htmlStr.push('<td><a href=/members/'+ list.no + '>' + list.email +'</a></td>');
					htmlStr.push('<td>'+ list.grade +'</td>');
					htmlStr.push('<td>'+ list.regDate +'</td>');
					htmlStr.push('<td>'+ list.visits +'</td>');
					htmlStr.push('<td>'+ list.ban +'</td>');
					htmlStr.push('</tr>');
				}
				console.log(data.paging);

				$('#memberBody').html(htmlStr.join(""));

				
				htmlStr = [];
				
				htmlStr.push('<button type="button" id="replay">원래대로</button>');
				$('#pageContent').html(htmlStr.join(""));
				
			},
			error : function(err) {
				console.log(err);
			}
		});
	}
	)
	$(document).on('click', '#replay', function(){
		location.href = "/members";
	});
	
});
</script>
</html>